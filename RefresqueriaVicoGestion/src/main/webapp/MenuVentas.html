<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Menú de Ventas</title>
  <style>
    .titulo {
      text-align: center;
      font-weight: bold;
    }

    .titulo .arriba {
      font-size: 20px;
      color: #ff9933;
      text-shadow: 1px 1px 1px black;
      letter-spacing: 2px;
      text-transform: uppercase;
      font-family: Arial, sans-serif;
    }

    .titulo .abajo {
      font-size: 48px;
      color: #1a75ff;
      font-family: 'Georgia', serif;
      text-shadow: 1px 1px 0px black, -1px -1px 0px black;
    }

    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: 'Segoe UI', sans-serif;
      background-color: #9fc1f3;
    }

    header, footer {
      padding: 10px 20px;
      background: #9fc1f3;
      border-bottom: 1px solid #ddd;
    }

    main {
      display: flex;
      height: calc(100vh - 100px);
    }

    .left-panel {
      flex: 2;
      padding: 20px;
      overflow-y: auto;
    }

    .right-panel {
      flex: 1;
      background: #9fc1f3;
      padding: 20px;
      border-left: 1px solid #ddd;
    }

    .categorias {
      display: flex;
      gap: 10px;
      margin-bottom: 20px;
    }

    .categoria {
      padding: 15px;
      border-radius: 5px;
      color: #fff;
      font-weight: bold;
      cursor: pointer;
      flex: 1;
      text-align: center;
    }

    .rojo { background: #d32f2f; }
    .verde { background: #388e3c; }
    .azul { background: #1976d2; }

    .productos {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
      gap: 15px;
    }

    .producto {
      background: #fff;
      border-radius: 8px;
      overflow: hidden;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      cursor: pointer;
      text-align: center;
    }

    .producto img {
      width: 100%;
      height: 100px;
      object-fit: cover;
    }

    .producto h4 {
      margin: 8px 0 4px;
      font-size: 16px;
    }

    .producto p {
      margin: 0 0 10px;
      color: #777;
      font-size: 14px;
    }

    .venta h2 {
      margin-top: 0;
    }

    .venta p {
      margin: 5px 0;
    }

    .botones-venta {
      margin-top: 20px;
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .pagar-btn {
      padding: 20px;
      background: #2ee94d;
      color: white;
      border: none;
      font-size: 18px;
      cursor: pointer;
      border-radius: 8px;
    }

    .accion-btn {
      padding: 10px;
      background: #e53935;
      color: white;
      border: none;
      font-size: 14px;
      cursor: pointer;
      border-radius: 5px;
    }

    .cancelar-btn {
      background: #757575;
    }

    .volver {
      position: absolute;
      top: 20px;
      left: 20px;
      font-size: 14px;
      color: #00796b;
      text-decoration: none;
    }
  </style>
</head>
<body>

<a class="volver" href="MainMenu.html">&larr; Volver al menú</a>

<header>
  <div class="titulo">
    <div class="arriba">REFRESQUERIA</div>
    <div class="abajo">VICO</div>
  </div>
</header>

<main>
  <div class="left-panel">
    <div class="categorias">
      <div class="categoria rojo" onclick="alert('Hielitos')">Hielitos</div>
      <div class="categoria verde" onclick="alert('Papas Locas')">Papas Locas</div>
      <div class="categoria azul" onclick="alert('Raspados')">Raspados</div>
    </div>

    <div class="productos" id="lista-productos">
      <!-- Los productos se cargarán aquí dinámicamente -->
    </div>
  </div>

  <div class="right-panel">
    <div class="venta">
      <h2>Venta nueva</h2>
      <p>No hay artículos en la cuenta</p>
      <hr>
      <p><strong>Subtotal:</strong> $0.00</p>
      <p><strong>Total:</strong> $0.00</p>

      <div class="botones-venta">
        <button class="pagar-btn" onclick="alert('Pagar')">Pagar</button>
        <button class="accion-btn" onclick="alert('Eliminar artículo')">Eliminar</button>
        <button class="accion-btn cancelar-btn" onclick="alert('Cancelar venta')">Cancelar</button>
      </div>
    </div>
  </div>
</main>

<script>
  const venta = [];
  const listaVenta = document.createElement("ul");
  listaVenta.style.listStyle = "none";
  listaVenta.style.padding = 0;

  function cargarProductos() {
    fetch("http://localhost:8081/RefresqueriaVicoGestion/api/productos")
            .then(response => {
              if (!response.ok) throw new Error("Error al obtener productos");
              return response.json();
            })
            .then(data => {
              const lista = document.getElementById("lista-productos");
              lista.innerHTML = "";
              data.forEach(producto => {
                const div = document.createElement("div");
                div.className = "producto";
                div.onclick = () => agregarProducto(producto);

                const img = document.createElement("img");
                img.src = producto.imagen || "https://via.placeholder.com/150x100?text=Producto";
                img.alt = producto.nombre;

                const nombre = document.createElement("h4");
                nombre.textContent = producto.nombre;

                const precio = document.createElement("p");
                precio.textContent = `$${producto.precio.toFixed(2)}`;

                div.appendChild(img);
                div.appendChild(nombre);
                div.appendChild(precio);
                lista.appendChild(div);
              });
            })
            .catch(error => console.error("Error:", error));
  }

  function agregarProducto(producto) {
    venta.push(producto);
    renderizarVenta();
  }

  function renderizarVenta() {
    const panel = document.querySelector(".venta");
    listaVenta.innerHTML = "";
    let subtotal = 0;

    venta.forEach((p, index) => {
      subtotal += p.precio;
      const li = document.createElement("li");

      const checkbox = document.createElement("input");
      checkbox.type = "checkbox";
      checkbox.dataset.index = index;
      checkbox.style.marginRight = "10px";

      li.appendChild(checkbox);
      li.appendChild(document.createTextNode(`${p.nombre} - $${p.precio.toFixed(2)}`));
      listaVenta.appendChild(li);
    });

    panel.innerHTML = `
      <h2>Venta nueva</h2>
      ${venta.length === 0 ? "<p>No hay artículos en la cuenta</p>" : ""}
    `;
    panel.appendChild(listaVenta);
    panel.innerHTML += `
      <hr>
      <p><strong>Subtotal:</strong> $${subtotal.toFixed(2)}</p>
      <p><strong>Total:</strong> $${subtotal.toFixed(2)}</p>
      <div class="botones-venta">
        <button class="pagar-btn" onclick="pagar()">Pagar</button>
        <button class="accion-btn" onclick="eliminarSeleccionados()">Eliminar</button>
        <button class="accion-btn cancelar-btn" onclick="cancelarVenta()">Cancelar</button>
      </div>
    `;
  }

  function eliminarSeleccionados() {
    const seleccionados = Array.from(listaVenta.querySelectorAll("input[type='checkbox']:checked"));
    if (seleccionados.length === 0) {
      alert("Selecciona al menos un producto para eliminar.");
      return;
    }
    const indices = seleccionados.map(cb => parseInt(cb.dataset.index));
    // Filtrar venta eliminando productos por índice
    for (let i = indices.length - 1; i >= 0; i--) {
      venta.splice(indices[i], 1);
    }
    renderizarVenta();
  }

  function cancelarVenta() {
    if (confirm("¿Estás seguro de cancelar la venta?")) {
      venta.length = 0;
      renderizarVenta();
    }
  }

  function pagar() {
    if (venta.length === 0) {
      alert("No hay productos para pagar.");
      return;
    }
    const total = venta.reduce((acc, p) => acc + p.precio, 0);
    alert(`Pago simulado exitoso. Total pagado: $${total.toFixed(2)}`);
    venta.length = 0;
    renderizarVenta();
  }

  window.onload = cargarProductos;
</script>

</body>
</html>

